---
title: "Version control for reproducible science"
author: "Brad Duthie"
date: "26 September 2018"
output: html_document
---


<!---

1. Initialise a new repository in StirlingCodingClub for how to understand and use git
2. Write up an Rmarkdown document introducing version control and how to get started with it in the command line and with GitKraken (would try to do by this WED).
3. As part of the Rmarkdown document, include a diverse list of outside links where people can go to get more help.
4. Post the slides early so that people know what to expect, give the opportunity for people to ask questions before arriving.
5. On 3 OCT, go through the slides, then demonstrate how to use git on the command line and GitKraken, allowing others to follow along.
6. Leave the repository up and address questions as issues when they arise.

--->

Introduction
================================================================================

- [git](https://git-scm.com/): A software for version control
- [GitHub](http://github.com): A website that enables collaboration and use of git
- [repository (repo)](): A folder that is using git

1. What is version control? {.what_is_vc}
================================================================================

[Version control](https://en.wikipedia.org/wiki/Version_control) is any system that records changes made within a repository over time so that different versions of files can be managed and, if necessary, recovered.


2. Why use version control? {.why_is_vc}
================================================================================

- Keep track of files that are edited by multiple collaborators simultaneously
- Easy way to undo changes to any point in the past
- Back up the entire history of a project

3. What is git? {.what_is_git}
================================================================================

- Open-source version control developed by Linus Torvalds
- Not an acronym for anything
- Not the same thing as [GitHub](http://github.com), which is a repository for git


4. How does version control work? {.how_does_vc}
================================================================================



5. How to use git in GitHub {.how_use_gh}
================================================================================


6. How to use git in the command line {.how_use_CLI}
================================================================================


- Cheat sheet
- Quick guide
- [Intro to the command line](https://www.youtube.com/watch?v=oK8EvVeVltE)


[Add](https://www.youtube.com/watch?v=9p2d-CuVlgc) the file `vc_notes.Rmd`.

```{bash, eval = FALSE}
brad@duthie-pc:~/Dropbox/projects/StirlingCodingClub/version_control$ git add vc_notes.Rmd
```

Commit the file with a message

```{bash, eval = FALSE}
brad@duthie-pc:~/Dropbox/projects/StirlingCodingClub/version_control$ git commit -m "Initialise version control notes"
[master (root-commit) d4861c3] Initialise version control notes
 1 file changed, 91 insertions(+)
 create mode 100644 vc_notes.Rmd

```

Add the rest of the files, then commit

```{bash, eval = FALSE}
brad@duthie-pc:~/Dropbox/projects/StirlingCodingClub/version_control$ git add *
brad@duthie-pc:~/Dropbox/projects/StirlingCodingClub/version_control$ git commit -m "Initialise rest of files"
[master 8f5ea29] Initialise rest of files
 3 files changed, 285 insertions(+)
 create mode 100644 git_cheat_sheet.pdf
 create mode 100644 vc_notes.html
```

Look at the status

```{bash, eval = FALSE}
brad@duthie-pc:~/Dropbox/projects/StirlingCodingClub/version_control$ git status
On branch master
nothing to commit, working directory clean
```

Look at the git log

```{bash, eval = FALSE}
brad@duthie-pc:~/Dropbox/projects/StirlingCodingClub/version_control$ git log
commit 6ddbaab81cda02f1e8ba116151456cef1f713f34
Author: Brad Duthie <brad.duthie@gmail.com>
Date:   Wed Sep 26 18:01:26 2018 +0100

    Add more notes

commit 8f5ea29c9bf37f5ba463c65ccb7bca0742b6c2bc
Author: Brad Duthie <brad.duthie@gmail.com>
Date:   Wed Sep 26 17:57:28 2018 +0100

    Initialise rest of files

commit d4861c30af1aefdc67f171bdef59731139545996
Author: Brad Duthie <brad.duthie@gmail.com>
Date:   Wed Sep 26 17:56:27 2018 +0100

    Initialise version control notes
```


7. Using GitKraken & Command Line Interface (CLI)
================================================================================

This set of instructions will get you started working with git and GitHub.

Step 1: Initialising a git repository
--------------------------------------------------------------------------------

Initialise a git repository using [GitKraken](http://gitkraken.com) by specifying the folder on your computer where you want the repository to be initialised by selecting the 'Init' tab (far left) and the 'Local' tab (top left) within GitKraken. If you cannot figure out how to get the the image below, go to the upper left folder icon within GitKraken.

![The GitKraken interface](images/GitKraken_init.png)

<br>

In the command line, this is done by first going to the folder where you want to initialise the repository.

```{bash, eval = FALSE}
brad@duthie-pc:~$ cd Dropbox/projects/StirlingCodingClub/version_control
```

Next, [initialise](https://www.youtube.com/watch?v=9p2d-CuVlgc) the git repository with `git init`.

```{bash, eval = FALSE}
brad@duthie-pc:~/Dropbox/projects/StirlingCodingClub/version_control$ git init
Initialised empty Git repository in /home/brad/Dropbox/projects/StirlingCodingClub/version_control/.git/
```

You now have a local repository initialised and are ready to start using git. Note that the repository is not yet linked with GitHub, but you can still view the repository within [GitKraken](http://gitkraken.com). The image below shows the version_control repository during an early stage of development (but several commits after initialisation). Each of the four cyan circles shows an individual commit with a message about what the commit is doing. I can go back to see what the directory looked like in a previous commit by clicking one of these circles.

![The GitKraken interface](images/GitKraken_1.png)

<br>

Note that the bottom area of the GitKraken interface shows the changes made during the last commit. You can also see the status of the git repository using the command line `git status`, which returns something like the below.

```{bash, eval = FALSE}
brad@duthie-pc:~/Dropbox/projects/StirlingCodingClub/version_control$ git status
On branch master

Initial commit

Untracked files:
  (use "git add <file>..." to include in what will be committed)

	git_cheat_sheet.pdf
	vc_notes.Rmd
	vc_notes.html

nothing added to commit but untracked files present (use "git add" to track)
```

The command `git log` returns a list of previous git commits (equivalent to the cyan circles in the GitKraken interface shown above). I will explain this more later, but first let's link the newly created git repository with GitHub.


Step 2: Linking your repository with GitHub
--------------------------------------------------------------------------------

To link GitKraken with your GitHub account, first go to GitHub and login. Next find and click the button that looks like the one below.

![](images/GitHub_new.png)

<br>

This will take you to the page that allows you to set up a new repository. **Be sure to use the same repository name on GitHub that you do on your local computer**, and avoid the use of spaces.

![](images/GitHub_create_rep.png)

<br>

After you click the green button 'Create repository', GitHub will take you to a place that gives you a URL for a quick setup. The URL for the version_control repository that I just set up is below.

![](images/GitHub_URL.png)

<br>

Copy that URL, then go back to GitKraken. Look at the left-hand side of the interface which has names that include 'Local', 'Remote', 'Pull Requests', etc. Hover over the 'Remote' tab and a green '+' should appear for you to click. This will open a box like the one below with the options 'URL', 'GitHub.com', and 'Bitbucket.org'.

![](images/GitKraken_add_remote.png)

<br>

Confusingly, you do not want to select the 'GitHub.com' tab. Select the URL tab instead; type in the repository name (the name on GitHub should be the same as the folder name on your computer), then paste the copied URL above into the 'Pull URL' field. The 'Push URL' field should be identical to the 'Pull URL' field. After you click the green 'Add Remote' button, you should be able to go back to the GitKraken interface and click the 'Push' button.

![](images/GitKraken_top.png)

<br>

After you click 'Push', you will be asked what branch to push and pull from. Keep 'master' for now and just click 'Submit'.

![](images/GitKraken_push.png)

<br>

Now if you go back to GitHub, you should see any files you had in your repository appear. 

If you want to link your local repository with GitHub using the command line instead of GitKraken, then after creating a new repository on GitHub, use the command below.

```{bash, eval = FALSE}
brad@duthie-pc:~/Dropbox/projects/StirlingCodingClub/version_control$ git remote add origin https://github.com/bradduthie/version_control.git
```

You can then push all of your files to the GitHub repository with the command below.

```{bash, eval = FALSE}
brad@duthie-pc:~/Dropbox/projects/StirlingCodingClub/version_control$ git push -u origin master
```

You should now have a git repository up and running on your local machine, and a linked version on GitHub. Next I will explain how to add and commit changes to files.

Step 3: Add and commit files
--------------------------------------------------------------------------------

Now that you have a repository ready to start tracking your changes, you can start making commits. The flow of this process as you work within your repository is typically (1) saving files, (2) adding (or 'staging') files , (3) committing files, and (4) pushing files too GitHub. Rather than saving the most recent changes that you've made to the files in your repository, the idea here is to save a snapshot of the whole repository using 'commit'. You can then always return to this commit to view what your repository looked like at a previous time. 

![](images/GitKraken_2.png)

In the above image, the history of commits is shown with in the cyan circles, along with a commit message written to explain the changes made in each commit (by convention, these are typically written in the present tense). So you can see that my most recent commits were to 'Add first image', and before that to 'Add some video links', etc. You can see what the directory looked like at these points by clicking on these commits (this is also possible in GitHub where you can see the [history of this repository](https://github.com/bradduthie/version_control/commits/master)). The very top shows WIP (work in progress), which is the directory as it looks at the moment.

As you work on your files, continue to save things as you normally would; you need to save before files can be added or committed. In the above, you can see the files 'vc_notes.Rmd' and 'vc_notes.html'. These have been saved recently, which is why they are listed as 'Unstaged files' (shown with yellow icons). In the command line, we can see the equivalent of these saved but unstaged files by typing `git status`.

```{bash, eval = FALSE}
brad@brad-ThinkPad-X201:~/Dropbox/projects/StirlingCodingClub/version_control$ git status
On branch master
Your branch is up-to-date with 'version_control/master'.
Changes not staged for commit:
  (use "git add <file>..." to update what will be committed)
  (use "git checkout -- <file>..." to discard changes in working directory)

	modified:   vc_notes.Rmd
	modified:   vc_notes.html

no changes added to commit (use "git add" and/or "git commit -a")
```


In the above, both files are listed as 'modified', but not staged.

Now assume that we want to commit the changes we have saved, establishing a snapshot of the directory that we can return to in the future. The common wisdom in using version control is **"commit early, commit often"**, meaning that it is generally better to err on the side of commiting changes that you make to your repository more often than you think is necessary. In practice, I try to commit frequently, almost as often as I save file changes; even small changes can be useful to have their own commit because the changes are easier to read in small chunks rather than massive changes to files. To commit our changes, we need to 'stage' the files. You can stage all of the changed files at once, if desired, or you can stage only a subset of them (if, e.g., you wanted to record a change in one file, but wait to commit changes in another file).


8. How to use git in Rstudio
================================================================================


9. Additional resources
================================================================================

**Introductions to version control (guides)**

- [British Ecological Society: A guide to reproducible code in ecology and evolution](https://www.britishecologicalsociety.org/wp-content/uploads/2017/12/guide-to-reproducible-code.pdf)
- [An introduction to version control](http://guides.beanstalkapp.com/version-control/intro-to-version-control.html)

**Introductions to version control (videos)**

- [Git and GitHub for Poets: Intro](https://www.youtube.com/watch?v=BCQHnlnPusY) (no programming knowledge needed)
- [Git and GitHub for Poets: Branches](https://www.youtube.com/watch?v=oPpnCh7InLY)
- [Git and GitHub for Poets: Fork and Pull](https://www.youtube.com/watch?v=_NrSWLQsDL4)











